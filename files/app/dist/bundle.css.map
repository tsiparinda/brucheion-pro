{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "FormLine.svelte",
    "Message.svelte",
    "PassageDesk.svelte",
    "ResizeBar.svelte",
    "TextAheadOverlay.svelte",
    "TextInput.svelte",
    "IngestCex.svelte",
    "IngestImage.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  export let id = ''\r\n  export let label = ''\r\n  export let offset = false\r\n</script>\r\n\r\n<style>\r\n  .offset {\r\n    margin-top: 25px;\r\n  }\r\n\r\n  .label-wrapper {\r\n    flex-grow: 1;\r\n  }\r\n\r\n  @media screen and (min-width: 769px) {\r\n    .label-wrapper {\r\n      display: flex;\r\n      flex-flow: row;\r\n      align-items: flex-start;\r\n      justify-content: flex-end;\r\n\r\n      padding: 0;\r\n    }\r\n  }\r\n\r\n  .line-label {\r\n    width: 125px;\r\n    padding: 6px 0;\r\n    text-align: right;\r\n    line-height: 1.5;\r\n  }\r\n\r\n  @media screen and (max-width: 768px) {\r\n    .line-label {\r\n      width: 100%;\r\n      text-align: left;\r\n      padding: 2px 0;\r\n    }\r\n  }\r\n</style>\r\n\r\n<div class=\"field is-horizontal\" class:offset>\r\n  <div class=\"field-label is-normal label-wrapper\">\r\n    {#if label}\r\n      <label class=\"label line-label\" for={id}>{label}</label>\r\n    {:else}\r\n      <div class=\"line-label\" />\r\n    {/if}\r\n  </div>\r\n  <div class=\"field-body\">\r\n    <div class=\"field\">\r\n      <div class=\"control\">\r\n        <slot />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n",
    "<script>\r\n  import growAndFade from '../transitions/growAndFade'\r\n\r\n  export let text = ''\r\n  export let error = false\r\n</script>\r\n\r\n<style>\r\n  em {\r\n    display: inline-block;\r\n    padding: 5px;\r\n\r\n    font-style: normal;\r\n    font-size: 90%;\r\n    font-weight: 500;\r\n  }\r\n\r\n  .error {\r\n    color: rgb(200, 10, 10);\r\n  }\r\n</style>\r\n\r\n<div transition:growAndFade>\r\n  <em class:error>{text}</em>\r\n</div>\r\n",
    "<script>\n  import { onMount } from 'svelte'\n  import { Link, navigate } from 'svelte-routing'\n  import OpenSeadragon from '../lib/openseadragon/openseadragon'\n  import { getInternalOpts } from '../lib/osd'\n  import ResizeBar from './ResizeBar.svelte'\n\n  export let passage\n\n  //   onMount(async () => {\n  //   const res = await fetch(`/api/v1/passage/undefined`);\n  //   passage = await res.json();\n  //   res = await fetch(`/api/v1/user`)\n  //   user = await res.json()\n  //   urn = passage.id\n  //   console.log(\"urn:\"+ urn);\n  // });\n\n  let previewViewer = undefined,\n    viewerOpts = undefined,\n    previewVisible = false,\n    previewFailed = false,\n    selectedImageRef = undefined,\n    didMount = false,\n    selectedCatalogUrn = passage.catalog.urn,\n    showMetadata = false,\n    previewContainer = undefined,\n    previewHeight = 350,\n    urn,\n    err\n\n  // FIXME: this is a pretty naive attempt to catch the passage ID\n  $: passageId = passage.id.split(':').pop()\n\n  $: Promise.all([getPassage(urn)])\n    .then(([p]) => {\n      passage = p\n    })\n    .catch((e) => (err = e))\n\n  async function getPassage(urn) {\n    const res = await fetch(`/api/v1/passage/${urn}`)\n    //const res = await fetch(`/api/v1/passage/undefined`)\n    //const res = await fetch(`/api/v1/passage/?urn=urn:cts:sktlit:skt0001.nyaya002.J1D:3.1.1`)\n    const d = await res.json()\n    return d.data\n  }\n\n  function createViewer(opts) {\n    const { tileSources, ...otherOpts } = opts\n    previewViewer = OpenSeadragon(otherOpts)\n\n    previewViewer.addHandler('open-failed', () => {\n      previewVisible = false\n      previewViewer.destroy()\n      previewFailed = true\n    })\n\n    previewViewer.addHandler('open', () => {\n      previewVisible = true\n    })\n\n    previewViewer.open(tileSources)\n  }\n\n  function updateViewer(refs) {\n    if (previewViewer) {\n      previewViewer.destroy()\n    }\n\n    if (Array.isArray(refs) && refs.length > 0) {\n      if (!selectedImageRef || !refs.includes(selectedImageRef)) {\n        selectedImageRef = refs[0]\n      }\n      viewerOpts = getInternalOpts('preview', selectedImageRef)\n\n      createViewer(viewerOpts)\n    }\n  }\n\n  function handleWitnessSelection() {\n    urn = selectedCatalogUrn //+ {passageId}\n    //navigate(`/PassageOverview/${selectedCatalogUrn}${passageId}`)\n  }\n\n  function handleToggleMetadata() {\n    showMetadata = !showMetadata\n  }\n  function handleHideMetadata() {\n    showMetadata = false\n  }\n\n  /* this should update the folio viewer a) once after mounting and b) when `passage` changes due to reactivity.\n   * this is just a lazy trick to trigger the viewer update in coordination with svelte's reactivity */\n  $: if (didMount) {\n    updateViewer(passage.imageRefs)\n  }\n  onMount(() => {\n    didMount = true\n  })\n\n  function handleResize(e) {\n    previewHeight = e.detail.y - previewContainer.offsetTop\n  }\n\n  function handleNextPassage() {\n    urn = passage.nextPassage\n  }\n  function handlePreviousPassage() {\n    urn = passage.previousPassage\n  }\n</script>\n\n<style>\n  .toolbar {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n\n    height: 40px;\n    margin: 0;\n    border-top: 1px solid var(--toolbar-border-color);\n    border-bottom: 1px solid var(--toolbar-border-color);\n    padding: 0;\n\n    list-style: none;\n    background: var(--toolbar-bg-color, white);\n  }\n\n  .toolbar,\n  .toolbar select {\n    font: 400 14px/100% 'Inter', sans-serif;\n    color: var(--toolbar-text-color, black);\n  }\n\n  .toolbar.stacked-below {\n    border-top: 0;\n  }\n\n  .toolbar li {\n    flex-shrink: 0;\n    margin: 0;\n    padding: 2px 8px;\n  }\n\n  /* join left */\n  .toolbar li.jl {\n    margin-left: 2px;\n  }\n  /* space left */\n  .toolbar li.pl {\n    margin-left: 8px;\n  }\n  /* border left */\n  .toolbar li.bl {\n    border-left: 1px solid var(--toolbar-border-color);\n  }\n  /* fill left */\n  .toolbar li.fl {\n    margin-left: auto;\n  }\n\n  .toolbar li:last-child {\n    border-right: 0;\n  }\n\n  .toolbar li label {\n    margin: 0;\n    padding: 0;\n\n    font-weight: 600;\n    font-size: inherit;\n  }\n\n  .toolbar li code {\n    font: 14px/100% 'IBM Plex Mono', monospace;\n    color: inherit;\n  }\n\n  .desk {\n    display: flex;\n    flex-direction: column;\n    flex-grow: 1;\n\n    width: 100%;\n    height: 100%;\n    min-height: 600px;\n  }\n\n  .pane {\n    flex-basis: 50%;\n    flex-shrink: 0;\n    flex-grow: 1;\n  }\n\n  .pane.static {\n    flex-grow: 0;\n  }\n\n  .pane.grow {\n    display: flex;\n    flex-direction: column;\n  }\n\n  .vertical-split {\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n  }\n\n  .vertical-split .pane {\n    border-left: 1px solid var(--toolbar-border-color);\n  }\n  .vertical-split .pane:first-child {\n    border-left: 0;\n  }\n\n  .preview {\n    display: flex;\n    flex-direction: column;\n    flex-grow: 0;\n    flex-shrink: 0;\n\n    box-sizing: border-box;\n    width: 100%;\n    height: var(--height, 500px);\n    padding: 4px;\n\n    background: var(--pane-bg-color);\n  }\n\n  :global(.openseadragon-container) {\n    flex-grow: 1;\n  }\n\n  .transcription {\n    box-sizing: border-box;\n    height: 100%;\n    padding: 16px;\n    overflow-y: scroll;\n  }\n\n  .metadata {\n    font: 14px/130% 'Inter', sans-serif;\n    background: white;\n  }\n\n  .metadata dl dt {\n    padding: 8px 16px 4px;\n  }\n\n  .metadata dl dd {\n    padding: 0px 16px 8px;\n  }\n\n  .metadata dl dt:nth-child(4n + 1),\n  .metadata dl dt:nth-child(4n + 1) + dd {\n    background: var(--pane-bg-color);\n  }\n\n  .close-pane {\n    font-size: 20px;\n    font-weight: 600;\n  }\n\n  .close-pane:hover {\n    text-decoration: none;\n  }\n</style>\n\n<nav role=\"navigation\">\n  <ul class=\"toolbar\">\n    <li>\n      <label for=\"passage.id\">Passage</label>\n    </li>\n\n    <li class=\"pl\">\n      <div class=\"select\">\n        <select\n          bind:value={selectedCatalogUrn}\n          on:click={handleWitnessSelection}>\n          {#each passage.textRefs as ref}\n            <option value={ref}>{ref}</option>\n          {/each}\n        </select>\n      </div>\n    </li>\n    <li class=\"jl\">\n      <code>{passageId}</code>\n    </li>\n\n    <li class=\"pl\">\n      <a href=\"#top\" on:click|preventDefault={handlePreviousPassage}>\n        ← Previous Passage\n      </a>\n    </li>\n    <li class=\"pl\">\n      <a href=\"#top\" on:click|preventDefault={handleNextPassage}>\n        Next Passage →\n      </a>\n    </li>\n\n    <li>\n      <label for=\"passage.id\">Folio</label>\n    </li>\n    <li>\n      <div class=\"select\">\n        <select bind:value={selectedImageRef}>\n          {#if !!passage.imageRefs}\n            {#each passage.imageRefs as ref}\n              <option value={ref}>{ref}</option>\n            {/each}\n          {:else}\n            <option disabled>No image references</option>\n          {/if}\n        </select>\n      </div>\n    </li>\n\n    <li class=\"pl\">\n      <Link to={`/edit2/${passage.id}`}>Edit References</Link>\n    </li>\n\n    <li class=\"pl\">\n      <a href=\"#top\" on:click|preventDefault={handleToggleMetadata}>\n        {#if showMetadata}Hide{:else}Show{/if}\n        Metadata\n      </a>\n    </li>\n\n  </ul>\n</nav>\n\n<div class=\"desk\">\n  <section class=\"pane grow static\">\n    <div\n      bind:this={previewContainer}\n      id=\"preview\"\n      class=\"preview\"\n      style=\"--height: {previewHeight}px\" />\n  </section>\n\n  <ResizeBar on:resize={handleResize} />\n\n  <section class=\"pane\">\n    <div class=\"vertical-split\">\n      <div class=\"pane\">\n        <ul class=\"toolbar\">\n          <li>\n            <label for=\"passage.id\">Transcription</label>\n          </li>\n          <li>\n            <a href={`/edit/${passage.id}`}>Edit</a>\n          </li>\n        </ul>\n        <div class=\"transcription\">\n          <p>\n            {#each passage.transcriptionLines as line}\n              {line}\n              <br />\n            {/each}\n          </p>\n        </div>\n      </div>\n      {#if showMetadata}\n        <div class=\"pane\">\n          <ul class=\"toolbar\">\n            <li>\n              <label for=\"passage.id\">Metadata</label>\n            </li>\n            <li>\n              <a href={`/editcat/${passage.id}`}>Edit</a>\n            </li>\n            <li class=\"fl\">\n              <a\n                href=\"#top\"\n                class=\"close-pane\"\n                on:click|preventDefault={handleHideMetadata}>\n                ×\n              </a>\n            </li>\n          </ul>\n          <div class=\"metadata\">\n            <dl>\n              <dt>Work URN</dt>\n              <dd>{passage.catalog.urn}</dd>\n              <dt>Scheme</dt>\n              <dd>{passage.catalog.citationScheme}</dd>\n              <dt>Workgroup</dt>\n              <dd>{passage.catalog.groupName}</dd>\n              <dt>Title</dt>\n              <dd>{passage.catalog.workTitle}</dd>\n              <dt>Version Label</dt>\n              <dd>{passage.catalog.versionLabel}</dd>\n              <dt>Exemplar Label</dt>\n              <dd>{passage.catalog.exemplarLabel}</dd>\n              <dt>Online</dt>\n              <dd>{passage.catalog.online}</dd>\n              <dt>Language</dt>\n              <dd>{passage.catalog.language}</dd>\n            </dl>\n          </div>\n        </div>\n      {/if}\n    </div>\n  </section>\n</div>\n",
    "<script>\r\n  import { createEventDispatcher } from 'svelte'\r\n\r\n  const dispatch = createEventDispatcher()\r\n  let barElement = undefined,\r\n    innerOffsetY = null\r\n  $: resizing = innerOffsetY !== null\r\n\r\n  function handleMouseDown(e) {\r\n    innerOffsetY = e.y - barElement.offsetTop\r\n    document.addEventListener('mousemove', handleMouseMove, false)\r\n  }\r\n\r\n  function handleMouseMove(e) {\r\n    dispatch('resize', {\r\n      y: e.y - innerOffsetY,\r\n    })\r\n  }\r\n\r\n  function handleMouseUp() {\r\n    innerOffsetY = null\r\n    document.removeEventListener('mousemove', handleMouseMove, false)\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .bar {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n\r\n    box-sizing: border-box;\r\n    width: 100%;\r\n    height: 12px;\r\n    padding: 4px;\r\n\r\n    background-color: var(--toolbar-bg-color);\r\n    border-top: 1px solid var(--toolbar-border-color);\r\n    cursor: ns-resize;\r\n    transition: background-color 120ms ease-in-out;\r\n  }\r\n\r\n  .bar.active {\r\n    background-color: rgb(255, 255, 255);\r\n  }\r\n\r\n  .handle {\r\n    flex-shrink: 0;\r\n    flex-grow: 0;\r\n    width: 32px;\r\n    height: 4px;\r\n    border-radius: 2px;\r\n    background-color: rgb(100, 100, 100);\r\n    transition: background-color 120ms ease-in-out;\r\n  }\r\n\r\n  .bar:hover .handle {\r\n    background-color: rgb(0, 0, 0);\r\n  }\r\n\r\n  .resizing {\r\n    cursor: ns-resize;\r\n  }\r\n</style>\r\n\r\n<svelte:window on:mouseup={handleMouseUp} />\r\n<svelte:body class:resizing />\r\n\r\n<div\r\n  class=\"bar\"\r\n  bind:this={barElement}\r\n  on:mousedown={handleMouseDown}\r\n  class:active={resizing}>\r\n  <div class=\"handle\" />\r\n</div>\r\n",
    "<script>\r\n  import { createEventDispatcher } from 'svelte'\r\n  import { fade, fly } from 'svelte/transition'\r\n  import { quintOut } from 'svelte/easing'\r\n\r\n  export let items\r\n  export let selectedIndex\r\n\r\n  const dispatch = createEventDispatcher()\r\n\r\n  function handleClose(index) {\r\n    dispatch('close', index)\r\n  }\r\n\r\n  function handleMouseMove(index) {\r\n    dispatch('select', index)\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .search-container {\r\n    position: relative;\r\n  }\r\n\r\n  .search {\r\n    position: absolute;\r\n    left: 0;\r\n    right: 0;\r\n    top: 0;\r\n    z-index: 50;\r\n\r\n    padding: 3px;\r\n  }\r\n\r\n  .item {\r\n    box-sizing: border-box;\r\n    border-radius: 4px;\r\n    padding: 3px 5px;\r\n\r\n    cursor: pointer;\r\n  }\r\n\r\n  .item.selected {\r\n    background: rgba(230, 230, 255);\r\n  }\r\n</style>\r\n\r\n<div class=\"search-container\">\r\n  <div\r\n    class=\"box search\"\r\n    in:fly={{ y: -5, duration: 150, delay: 0, opacity: 0.2, start: 0.0, easing: quintOut }}\r\n    out:fade={{ duration: 125, easing: quintOut }}>\r\n    {#each items as item, i}\r\n      <div\r\n        class=\"item\"\r\n        class:selected={i === selectedIndex}\r\n        on:click={() => handleClose(i)}\r\n        on:mousemove={() => handleMouseMove(i)}>\r\n        {@html item.label}\r\n      </div>\r\n    {/each}\r\n  </div>\r\n</div>\r\n",
    "<script>\r\n  import { createEventDispatcher } from 'svelte'\r\n  import Message from './Message.svelte'\r\n  import TextAheadOverlay from './TextAheadOverlay.svelte'\r\n  import debounce from '../lib/debounce'\r\n\r\n  export let id\r\n  export let value\r\n  export let placeholder = ''\r\n  export let inputRef = undefined\r\n  export let validate = () => true\r\n  export let disabled = false\r\n  export let invalidMessage = undefined\r\n  export let autocomplete = 'on'\r\n  export let invalid = false\r\n\r\n  export let items = undefined\r\n  export let minLength = 3\r\n  export let maxItems = 10\r\n\r\n  const dispatch = createEventDispatcher()\r\n\r\n  let changed = false\r\n  let overlayOpen = false\r\n  let selectedIndex = 0\r\n  let timer = null\r\n  let results = []\r\n\r\n  const setInvalid = debounce(() => (invalid = true), 1000)\r\n  $: changed = changed || (value !== '' && !changed)\r\n  $: if (!items) {\r\n    if (changed && !validate(value)) {\r\n      setInvalid()\r\n    } else {\r\n      setInvalid.cancel()\r\n      invalid = false\r\n    }\r\n  }\r\n\r\n  const regExpEscape = (s) => {\r\n    return s.replace(/[-\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\r\n  }\r\n\r\n  function handleBlur() {\r\n    timer = setTimeout(() => {\r\n      overlayOpen = false\r\n      invalid = changed && !validate(value)\r\n    }, 250)\r\n  }\r\n\r\n  function handleFocus() {\r\n    clearTimeout(timer)\r\n  }\r\n\r\n  const closeOverlay = (index = -1) => {\r\n    overlayOpen = false\r\n    selectedIndex = -1\r\n\r\n    if (index > -1) {\r\n      value = results[index].value\r\n    }\r\n  }\r\n\r\n  const handleChange = (event) => {\r\n    const term = event.target.value\r\n\r\n    if (term.length >= Number(minLength)) {\r\n      overlayOpen = true\r\n      filterResults(term)\r\n    } else {\r\n      results = []\r\n    }\r\n  }\r\n\r\n  const filterResults = (term) => {\r\n    results = items\r\n      .filter((item) => {\r\n        if (typeof item !== 'string') item = item.value || ''\r\n        return item.toUpperCase().includes(term.toUpperCase())\r\n      })\r\n      .map((item, i) => {\r\n        const text = typeof item !== 'string' ? item.value : item\r\n\r\n        return {\r\n          key: item.key || i,\r\n          value: text,\r\n          label:\r\n            term.trim() === ''\r\n              ? text\r\n              : text.replace(\r\n                  RegExp(regExpEscape(term.trim()), 'i'),\r\n                  \"<span style='font-weight: 600;'>$&</span>\"\r\n                ),\r\n        }\r\n      })\r\n      .slice(0, maxItems - 1)\r\n  }\r\n\r\n  function handleKeyDown(event) {\r\n    if (event.keyCode === 40 && selectedIndex < results.length - 1) {\r\n      selectedIndex += 1\r\n    } else if (event.keyCode === 38 && selectedIndex > 0) {\r\n      selectedIndex -= 1\r\n    } else if (event.keyCode === 13) {\r\n      event.preventDefault()\r\n\r\n      if (selectedIndex === -1) selectedIndex = 0\r\n      closeOverlay(selectedIndex)\r\n    } else if (event.keyCode === 27) {\r\n      event.preventDefault()\r\n      closeOverlay()\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  input {\r\n    background-color: white;\r\n    border-color: #dbdbdb;\r\n    border-radius: 4px;\r\n    color: #363636;\r\n  }\r\n</style>\r\n\r\n<div>\r\n  <input\r\n    {id}\r\n    class=\"input\"\r\n    class:is-danger={invalid}\r\n    type=\"text\"\r\n    {disabled}\r\n    {placeholder}\r\n    autocomplete={items ? 'off' : autocomplete}\r\n    bind:value\r\n    bind:this={inputRef}\r\n    on:focus={() => items && handleFocus()}\r\n    on:blur={() => items && handleBlur()}\r\n    on:input={(event) => items && handleChange(event)}\r\n    on:keydown={(event) => items && handleKeyDown(event)} />\r\n\r\n  {#if items && overlayOpen && results.length > 0}\r\n    <TextAheadOverlay\r\n      items={results}\r\n      {selectedIndex}\r\n      on:close={(event) => closeOverlay(event.detail)}\r\n      on:select={(event) => (selectedIndex = event.detail)} />\r\n  {/if}\r\n\r\n  {#if invalidMessage && invalid}\r\n    <Message text={invalidMessage} error />\r\n  {/if}\r\n</div>\r\n",
    "<script>\n  import FormLine from '../components/FormLine.svelte'\n  import Message from '../components/Message.svelte'\n\n  let inputRef, formRef\n  let cexFile = ''\n  let complete = false\n  let loading = false\n  let modalVisible = false\n  let errorMessage = null\n\n  const errorMessages = {\n    bad_file_ext:\n      'The submitted file did not have the corresponding .cex file extension.',\n    bad_file_body: 'The submitted file could not be read.',\n    file_not_found: 'The submitted file could not be read.',\n    bad_cex_data:\n      'The CEX data contained erroneous data and could not be processed.',\n    unknown:\n      'An unknown error occurred. This is not necessarily due to the uploaded CEX data. Please try again and log in again if necessary.',\n  }\n\n  function showModal() {\n    modalVisible = true\n  }\n  function hideModal() {\n    modalVisible = false\n    errorMessage = null\n  }\n\n  async function handleSubmit(event) {\n    event.preventDefault()\n    if (inputRef.files.length < 1) {\n      return\n    }\n\n    const file = inputRef.files[0]\n    const formData = new FormData()\n    formData.append('file', file)\n\n    let res\n    loading = true\n    try {\n      res = await fetch('/api/v1/cexupload', {\n        method: 'POST',\n        body: formData,\n        redirect: 'error',\n        credentials: 'same-origin',\n      })\n    } catch (err) {\n      loading = false\n      errorMessage = errorMessages.unknown\n      showModal()\n      return\n    }\n    loading = false\n\n    if (res.status !== 200) {\n      try {\n        const data = await res.json()\n        if (typeof errorMessages[data.message] !== 'undefined') {\n          errorMessage = errorMessages[data.message]\n        } else {\n          errorMessage = errorMessages.unknown\n        }\n      } catch (err) {\n        errorMessage = errorMessages.unknown\n      }\n    } else {\n      formRef.reset()\n    }\n\n    showModal()\n  }\n\n  $: complete = !!cexFile\n</script>\n\n<style>\n  .form-column {\n    max-width: 724px;\n  }\n\n  .form {\n    box-sizing: border-box;\n    max-width: 700px;\n    padding: 25px;\n  }\n\n  .input-file {\n    padding: 4px 0;\n  }\n</style>\n\n<div class=\"container\">\n  <section>\n    <div class=\"columns\">\n      <div class=\"column form-column\">\n        <p>\n          Ingest references created previously to set up a project on Brucheion.\n          Please select the respective CEX file below and submit the file to\n          start the ingestion process.\n        </p>\n\n        <form class=\"form\" bind:this={formRef} on:submit={handleSubmit}>\n          <FormLine id=\"cex-file\" label=\"CEX File\">\n            <input\n              id=\"cex-file\"\n              type=\"file\"\n              accept=\".cex\"\n              class=\"input-file\"\n              bind:value={cexFile}\n              bind:this={inputRef} />\n          </FormLine>\n\n          <FormLine offset>\n            <Message\n              text=\"Processing CEX data may take up to several minutes. Please\n              don't refresh the page while ingestion is in progress.\" />\n          </FormLine>\n          <FormLine>\n            <button\n              class=\"button is-success\"\n              type=\"submit\"\n              class:is-loading={loading}\n              disabled={!complete || loading}\n              on:click={handleSubmit}>\n              Ingest\n            </button>\n          </FormLine>\n        </form>\n\n        <div class=\"modal\" class:is-active={modalVisible}>\n          <div class=\"modal-background\" on:click={hideModal} />\n          <div class=\"modal-card\">\n            <header class=\"modal-card-head\">\n              <p class=\"modal-card-title\">\n                {#if errorMessage !== null}Error{:else}Ingestion Successful{/if}\n              </p>\n              <button class=\"delete\" aria-label=\"close\" on:click={hideModal} />\n            </header>\n            <section class=\"modal-card-body\">\n              {#if errorMessage !== null}\n                <p>{errorMessage}</p>\n              {:else}\n                <p>The CEX data has been ingested successfully.</p>\n              {/if}\n            </section>\n            <footer class=\"modal-card-foot\">\n              <button class=\"button\" on:click={hideModal}>Dismiss</button>\n            </footer>\n            <button\n              class=\"modal-close is-large\"\n              aria-label=\"close\"\n              on:click={hideModal} />\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</div>\n",
    "<script>\n  import { stringify as stringifyQuery } from 'qs'\n  import OpenSeadragon from '../lib/openseadragon/openseadragon'\n  import { onMount } from 'svelte'\n  import { navigate } from 'svelte-routing'\n  import FormLine from '../components/FormLine.svelte'\n  import Message from '../components/Message.svelte'\n  import { validateUrn } from '../lib/cts-urn'\n  import TextInput from '../components/TextInput.svelte'\n  import { validateHttpUrl } from '../lib/url'\n  import { isIIIFImage } from '../lib/iiif'\n  import { getStaticOpts, getIIIFOpts, getInternalOpts } from '../lib/osd'\n\n  let collection = ''\n  let imageName = ''\n  let imageUrl = ''\n  let external = true\n  let protocol = 'static'\n\n  let statusMessage = null,\n    timeoutHandle = null\n  let collectionRef, imageNameRef\n  let collections = []\n  let nameExists = false\n  let previewViewer = undefined,\n    viewerOpts = undefined,\n    previewVisible = false,\n    previewErrored = false\n\n  $: validNames =\n    validateUrn(collection, { noPassage: true }) && validateUrn(imageName)\n  $: validSource = validateUrn(imageUrl) || validateHttpUrl(imageUrl)\n  $: complete = validNames && validSource\n\n  $: if (statusMessage !== null) {\n    clearTimeout(timeoutHandle)\n    timeoutHandle = setTimeout(() => (statusMessage = null), 10000)\n  }\n  $: errorMessage =\n    statusMessage && statusMessage.toLowerCase().includes('error')\n  $: external = !validateUrn(imageUrl)\n  $: if (validNames) {\n    fetch(`/getImageInfo/${collection}/${imageName}`).then(async (res) => {\n      const imageInfo = await res.json()\n      nameExists = !!imageInfo.urn\n    })\n  } else if (nameExists) {\n    nameExists = false\n  }\n\n  async function displayExternalMedia(imageUrl) {\n    try {\n      const [isManifest, imageManifest] = await isIIIFImage(imageUrl)\n      if (isManifest) {\n        viewerOpts = getIIIFOpts('preview', imageManifest)\n        protocol = 'iiif'\n      } else {\n        viewerOpts = getStaticOpts('preview', imageUrl)\n        protocol = 'static'\n      }\n    } catch (err) {\n      if (!err.message.includes('NetworkError')) {\n        console.error(err.message)\n      }\n\n      viewerOpts = getStaticOpts('preview', imageUrl)\n      protocol = 'static'\n    }\n  }\n\n  $: if (validSource) {\n    previewErrored = false\n\n    if (validateHttpUrl(imageUrl)) {\n      displayExternalMedia(imageUrl)\n    } else if (validateUrn(imageUrl)) {\n      viewerOpts = getInternalOpts('preview', imageUrl)\n      protocol = 'localDZ'\n    }\n  }\n\n  function createViewer(opts) {\n    const { tileSources, ...otherOpts } = opts\n    previewViewer = OpenSeadragon(otherOpts)\n\n    previewViewer.addHandler('open-failed', () => {\n      previewVisible = false\n      previewViewer.destroy()\n      previewErrored = true\n    })\n\n    previewViewer.addHandler('open', () => {\n      previewVisible = true\n    })\n\n    previewViewer.open(tileSources)\n  }\n\n  /* We'll need to trick the Svelte reactivity here, since destroying a prior viewer before creating a new one will result\n   * in a circular dependency within the $-statement. Hence, above we just create the viewer options and handle viewer\n   * lifecycles in the below $-statement.\n   */\n  $: if (validSource && viewerOpts) {\n    if (previewViewer) {\n      previewVisible = false\n      previewViewer.destroy()\n    }\n\n    createViewer(viewerOpts)\n  }\n\n  onMount(async () => {\n    const query = new URLSearchParams(location.search)\n    if (query.has('collection')) {\n      if (validateUrn(query.get('collection'), { noPassage: true })) {\n        collection = query.get('collection')\n        imageNameRef.focus()\n      } else {\n        query.delete('collection')\n        navigate(`/ingest?${query.toString()}`, { replace: true })\n      }\n    } else {\n      collectionRef.focus()\n    }\n\n    await fetchCollections()\n  })\n\n  async function fetchCollections() {\n    const res = await fetch('/requestImgCollection/')\n    collections = (await res.json()).item\n  }\n\n  async function handleSubmit(event) {\n    event.preventDefault()\n    if (!complete) {\n      return\n    }\n\n    const query = {\n      name: collection,\n      urn: imageName,\n      location: imageUrl,\n      external,\n      protocol,\n    }\n    const res = await fetch(`/addtoCITE?${stringifyQuery(query)}`)\n    if (res.status !== 200) {\n      console.error(`Ingestion failed: HTTP ${res.status} ${await res.text()}`)\n      statusMessage = 'An error occurred. Please try later.'\n      return\n    }\n    statusMessage = 'Image ingested.'\n    window.setTimeout(() => {\n      imageName = ''\n      imageNameRef.focus()\n    }, 2500)\n  }\n</script>\n\n<style>\n  .form-column {\n    max-width: 724px;\n  }\n\n  .form {\n    box-sizing: border-box;\n    max-width: 700px;\n    padding: 25px;\n  }\n\n  select {\n    background-color: white;\n    border-color: #dbdbdb;\n    border-radius: 4px;\n    color: #363636;\n  }\n\n  input[type='checkbox'] {\n    position: relative;\n    margin: 0 6px 3px 3px;\n  }\n\n  .preview-container {\n    margin-top: 25px;\n    padding: 25px;\n    opacity: 0;\n\n    transition: opacity 125ms ease-out;\n  }\n\n  .preview-container.visible {\n    opacity: 1;\n  }\n\n  @media screen and (min-width: 1088px) {\n    .preview-container {\n      margin-top: 0;\n    }\n  }\n\n  .preview {\n    box-sizing: border-box;\n    max-width: 701px;\n    height: 601px;\n    border: 2px solid rgba(230, 230, 230);\n    border-radius: 4px;\n    padding: 4px;\n\n    background: rgba(246, 245, 245);\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.15);\n  }\n</style>\n\n<div class=\"container is-fluid\">\n  <section>\n    <div class=\"columns is-desktop\">\n      <div class=\"column form-column\">\n        <form class=\"form\" on:submit={handleSubmit}>\n          <h4 class=\"title is-4\">Media Data</h4>\n          <FormLine id=\"collection\" label=\"Collection\">\n            <TextInput\n              id=\"collection\"\n              placeholder=\"Collection CITE URN\"\n              bind:value={collection}\n              bind:inputRef={collectionRef}\n              validate={(value) => validateUrn(value, { noPassage: true })}\n              invalidMessage=\"Please enter a valid CITE collection URN.\"\n              items={collections} />\n          </FormLine>\n\n          <FormLine id=\"name\" label=\"Image Name\">\n            <TextInput\n              id=\"name\"\n              placeholder=\"Image CITE URN\"\n              bind:value={imageName}\n              bind:inputRef={imageNameRef}\n              validate={(value) => validateUrn(value)}\n              invalidMessage=\"Please enter a valid CITE object URN.\"\n              autocomplete=\"off\" />\n            {#if nameExists}\n              <Message\n                text=\"This URN already exists and will be replaced if submitted.\" />\n            {/if}\n          </FormLine>\n\n          <FormLine id=\"source\" label=\"Source\">\n            <TextInput\n              id=\"source\"\n              placeholder=\"Resource URL\"\n              bind:value={imageUrl}\n              validate={(value) => validateUrn(value) || validateHttpUrl(value)}\n              invalidMessage=\"Please enter a valid CITE object URN or a HTTP(S)\n              URL.\" />\n            {#if previewErrored}\n              <Message\n                text=\"The media could not be loaded for preview due to errors.\n                You can ingest it nonetheless.\" />\n            {/if}\n          </FormLine>\n\n          <FormLine id=\"protocol\" label=\"Type\">\n            <div class=\"select\">\n              <select id=\"protocol\" bind:value={protocol}>\n                <option value=\"static\">Static</option>\n                <option value=\"localDZ\">Deep Zoom (local)</option>\n                <option value=\"iiif\">IIIF</option>\n              </select>\n            </div>\n          </FormLine>\n\n          <FormLine offset>\n            <button\n              class=\"button is-success\"\n              disabled={!complete}\n              on:click={handleSubmit}>\n              Add Image\n            </button>\n            {#if statusMessage}\n              <Message text={statusMessage} error={errorMessage} />\n            {/if}\n          </FormLine>\n        </form>\n      </div>\n      <div class=\"column form-column\">\n        <div class=\"preview-container\" class:visible={previewVisible}>\n          <h3 class=\"title is-4\">Preview</h3>\n          <div id=\"preview\" class=\"preview\" />\n        </div>\n      </div>\n    </div>\n  </section>\n</div>\n"
  ],
  "names": [],
  "mappings": "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"
}